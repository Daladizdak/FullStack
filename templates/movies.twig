<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1">
				<title>My Movies</title>
				<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

	<body>
		<div class="container mt-4">
			<h1 class="mb-4 text-center">Best Movies Of All time</h1>

			
<div class="row g-3 align-items-start mb-3">

    
    <div class="col-md-4">
        <label for="searchBox" class="form-label">Search by name</label>
        <input
            type="text"
            class="form-control"
            id="searchBox"
            placeholder="Movie name...">

        <ul id="suggestions" class="list-group mt-1"></ul>

        <div id="spinner" class="text-primary my-2" style="display:none;">
            <div class="spinner-border spinner-border-sm" role="status"></div>
            <span class="ms-1">Searching…</span>
        </div>
    </div>

   
    <div class="col-md-3">
        <label for="genreFilter" class="form-label">Genre</label>
        <input
            type="text"
            class="form-control"
            id="genreFilter"
            placeholder="e.g. War, Comedy">
    </div>

    
    <div class="col-md-2">
        <label for="yearBefore" class="form-label">Before year</label>
        <input
            type="number"
            class="form-control"
            id="yearBefore"
            placeholder="e.g. 2020">
    </div>

    
    <div class="col-md-3 text-end">
        {% if loggedIn %}
            <a href="logout.php" class="btn btn-outline-secondary">Logout</a>
        {% else %}
            <a href="login.php" class="btn btn-outline-primary">Login</a>
        {% endif %}
    </div>

</div>
			<table class="table table-striped">
				<thead>
					<tr>
						<th>Movie Name</th>
						<th>Genre</th>
						<th>Release date</th>
						<th>Score</th>
						<th>Favourite</th>
						<th>Adjust</th>
					</tr>
				</thead>

				<tbody id="movieTableBody">
					
					{% for movie in movies %}
						<tr id="movie-row-{{ movie.Movie_id }}">
    						<td>
        					{{ movie.Movie_name }}
    						</td>
    						<td>{{ movie.Genre }}</td>
    						<td>{{ movie.Release_Date }}</td>
    						<td class="movie-score">{{ movie.Score|number_format(0) }}/100</td>

    						<td class="movie-fav">
						{% if loggedIn %}
        					<button
            					type="button"
            					class="btn btn-link btn-sm p-0 btn-fav"
            					data-id="{{ movie.Movie_id }}"
            					data-fav="{{ movie.Favorite ?? 0 }}"
        					>
            					{% if movie.Favorite %}
                				★
            					{% else %}
                				☆
            					{% endif %}

       			 			</button>

						{% else %}
							<span class="text-muted">☆</span>
						{% endif %}

    						</td>

    						<td>
							{% if loggedIn %}
        						<button
								class="btn btn-sm btn-primary btn-edit"
								data-id="{{ movie.Movie_id }}"
								data-name="{{ movie.Movie_name }}"
								data-genre="{{ movie.Genre }}"
								data-date="{{ movie.Release_Date }}"
								data-score="{{ movie.Score }}">
								Edit
							</button>

							<button
								class="btn btn-sm btn-danger btn-delete"
								data-id="{{ movie.Movie_id }}">
								Delete
							</button>
							{% else %}
								<span class="text-muted small">Login to edit</span>
 							{% endif %}

   						</td>
						</tr>
					{% endfor %}

				</tbody>
			</table>
			
			<p id="noResultsMessage" class="text-muted" style="display:none;">No movies found.</p>

			{% if loggedIn %}
			<button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addMovieModal">
				Add a Movie
			</button>
			{% endif %}


			
		</div>

		{# Add Movie Modal #}
		<div class="modal fade" id="addMovieModal" tabindex="-1" aria-labelledby="addMovieLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="addMovieLabel">Add a Movie</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form id="addMovieForm">
							<div class="mb-3">
								<label for="MovieName" class="form-label">Movie Name</label>
								<input type="text" class="form-control" id="MovieName" name="MovieName" required="">
								<div id="duplicateWarning" class="text-danger small mb-2"></div>
					</div>
							<div class="mb-3">
								<label for="Genre" class="form-label">Genre</label>
								<input type="text" class="form-control" id="Genre" name="Genre" required="">
					</div>
							<div class="mb-3">
								<label for="ReleaseDate" class="form-label">Release Date</label>
								<input type="date" class="form-control" id="ReleaseDate" name="ReleaseDate" required="">
					</div>
							<div class="mb-3">
								<label for="Score" class="form-label">Score</label>
								<input type="number" class="form-control" id="Score" name="Score" required="">
					</div>
					
					<div class="mb-3">
   						 <label class="form-label" id="addCaptchaQuestion"></label>

   						 <input type="number"
          					 class="form-control"
           					 id="addCaptchaAnswer"
          					 name="captcha_answer"
          					 required>

   						
    						<input type="hidden" id="addCaptchaA" name="captcha_a">
    						<input type="hidden" id="addCaptchaB" name="captcha_b">
						</div>

	

							<div id="addError" class="text-danger mb-2"></div>
							<button type="submit" class="btn btn-primary">Save movie</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		{# Edit Movie Modal #}
		<div class="modal fade" id="editMovieModal" tabindex="-1" aria-labelledby="editMovieLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="editMovieLabel">Edit Movie</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form id="editMovieForm">
							<input type="hidden" id="EditMovieId" name="Movie_id">

								<div class="mb-3">
									<label for="EditMovieName" class="form-label">Movie Name</label>
									<input type="text" class="form-control" id="EditMovieName" name="MovieName" required="">
					</div>
								<div class="mb-3">
									<label for="EditGenre" class="form-label">Genre</label>
									<input type="text" class="form-control" id="EditGenre" name="Genre" required="">
					</div>
								<div class="mb-3">
									<label for="EditReleaseDate" class="form-label">Release Date</label>
									<input type="date" class="form-control" id="EditReleaseDate" name="ReleaseDate" required="">
					</div>
								<div class="mb-3">
									<label for="EditScore" class="form-label">Score</label>
									<input type="number" class="form-control" id="EditScore" name="Score" required="">
					</div>

                                         <div class="mb-3">
    						<label class="form-label" id="editCaptchaQuestion"></label>
    						<input type="number"
           					class="form-control"
           					id="editCaptchaAnswer"
          					name="captcha_answer"
           					required>

   						 <input type="hidden" id="editCaptchaA" name="captcha_a">
    						 <input type="hidden" id="editCaptchaB" name="captcha_b">
					 </div>



								<div id="editError" class="text-danger mb-2"></div>
								<button type="submit" class="btn btn-primary">Save changes</button>
							</form>
					</div>
				</div>
			</div>
		</div>


		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		crossorigin="anonymous">	
		</script>
		
		<script>
    		const LOGGED_IN = {{ loggedIn ? 'true' : 'false' }};
		</script>

		<script src="js/successMessage.js"></script>
		<script src="js/search.js"></script>
		<script src="js/addMovie.js"></script>
		<script src="js/editMovie.js"></script>
		<script src="js/deleteMovie.js"></script>
		<script src="js/favorite.js"></script>
		<script src="js/captcha.js"></script>



	</body>
</html>
